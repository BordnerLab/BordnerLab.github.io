<!DOCTYPE html>
<html>

<head>
	<!-- link mapbox library -->
	<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.21.0/mapbox-gl.js'></script>
	
	<!-- link mapbox styling -->
	<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.21.0/mapbox-gl.css' rel='stylesheet' />
	
	<style>
		body {
			margin:0;
			padding:0;
			overflow:hidden;
		}
		
		#map {
			position: absolute;
			top:0;
			bottom: 0;
			width:100%;
			height:100%;
		}
		
		.mapboxgl-popup {

		}
		
		#geocoder-container {
			position: absolute;
			top: 0;
			width: 100%;
			margin-top: 10px;
		}

		#geocoder-container > div {
			min-width:50%;
			margin-left:25%;
		}
		
		
		#pitch {
			writing-mode: bt-lr;
			-webkit-appearance: slider-vertical;
			position: absolute;
			height: 125px;
			width: auto;
			top:100px;
			right:16px;
			background: transparent;
		}
		
		#toolbar {
			position: absolute;
			width: 50px;
			height: 200px;
			background: black;
			top: 250px;
			right: 0;
			transform: translate(0);
			-webkit-transform: translate(0);
			-moz-transform: translate(0);
			-ms-transform: translate(0);
			-webkit-transition: transform .35s;
			transition: transform .35s;
			-moz-transition: transform .35s;
			border-radius:10px;
			
		}
		
		#toolbar #grabHandle {
			position: relative;
			width: 20px;
			height: 50px;
			background:black;
			top: 75px;
			cursor:pointer;
			left:-20px;
			border-top-left-radius:10px;
			border-bottom-left-radius:10px;
		}
		
		#legend {
			position: absolute;
			width: 100px;
			height:280px;
			top:0;
			left:0;
			background: rgba(0,0,0,0.4);
		}
		
		#legend .legendSquare {
			position: absolute;
			height: auto;
			width: 100%;
			left: 0;
			cursor:pointer;
			text-align:center;
			padding-top:5px;
			padding-bottom:5px;
			color:white;
		}
	</style>
</head>
<body>
	<div id='map'></div>
	<div id='geocoder-container'></div>
	
	
	<input type="range" name="pitch" id="pitch" value="0" min="0" max="60" defaultValue="0" onchange="updateSlider(this.id)" orient="vertical">
	
	<div id='toolbar'>
		<div id='grabHandle' onclick="toggleToolbar()"></div>
		<div id='button01' style="position:absolute; height:50px; width: 50px; background:green; top:0; border-top-left-radius:10px; border-top-right-radius:10px; cursor:pointer;" onclick="fullDisplay()"></div>
		<div id='button02' style="position:absolute; height:50px; width:50px; background:grey; top:50px; cursor:pointer;" onclick="selectByCounty()"></div>
		<div id='button03' style="position:absolute; height:50px; width:50px; background:red; top:100px; cursor:pointer;" onclick="displaySettingsMenu()"></div>
		<div id='button04' style="position:absolute; height:50px; width:50px; background:blue; top:150px; border-bottom-left-radius:10px; border-bottom-right-radius:10px; cursor:pointer;"></div>
	</div>
	
	<div id='legend'>
		<div id="A4" class="legendSquare" style="top:0; background: #EE7600;" onmouseover="displayLikeLegend(this.id)" onmouseout="resetLikeLegend()">A4</div>
		<div id="A3" class="legendSquare" style="top:35px; background:#FB9B9C;" onmouseover="displayLikeLegend(this.id)" onmouseout="resetLikeLegend()">A3</div>
		<div id="B4" class="legendSquare" style="top:70px; background:#9B9CFB;" onmouseover="displayLikeLegend(this.id)" onmouseout="resetLikeLegend()">B4</div>
		<div id="C4" class="legendSquare" style="top:105px; background:#CD69C9;" onmouseover="displayLikeLegend(this.id)" onmouseout="resetLikeLegend()">C4</div>
		<div id="C4b" class="legendSquare" style="top:140px; background:#99004D;" onmouseover="displayLikeLegend(this.id)" onmouseout="resetLikeLegend()">C4b</div>
		<div id="F4" class="legendSquare" style="top:175px; background:#2DA0BA;" onmouseover="displayLikeLegend(this.id)" onmouseout="resetLikeLegend()">F4</div>
		<div id="MF" class="legendSquare" style="top:210px; background:#435645;" onmouseover="displayLikeLegend(this.id)" onmouseout="resetLikeLegend()">MF</div>
		<div id="ER" class="legendSquare" style="top:245px; background:#9B9CFB;" onmouseover="displayLikeLegend(this.id)" onmouseout="resetLikeLegend()">ER</div>
	</div>
	
	
	
	<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v1.3.0/mapbox-gl-geocoder.js'></script>
	<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v1.3.0/mapbox-gl-geocoder.css' type='text/css' />
	<script>
	
	var countyIDArr = [
		"ashlandWetlands",
		"bayfieldWetlands",
		"brownWetlands",
		"doorWetlands",
		"douglasWetlands",
		"ironWetlands",
		"kenoshaWetlands",
		"kewauneeWetlands",
		"marinetteWetlands",
		"ozaukeeWetlands",
		"racineWetlands",
		"sheboyganWetlands"
	];
	
	var countyNames = [
		"Ashland",
		"Bayfield",
		"Brown",
		"Door",
		"Douglas",
		"Iron",
		"Kenosha",
		"Kewaunee",
		"Marinette",
		"Ozaukee",
		"Racine",
		"Sheboygan"
	];
	
	var currentLayers = [];
	
	var tempLayers = [];
	
	var hoverLayers = [
		"ashlandWetlands",
		"bayfieldWetlands",
		"brownWetlands",
		"doorWetlands",
		"douglasWetlands",
		"ironWetlands",
		"kenoshaWetlands",
		"kewauneeWetlands",
		"marinetteWetlands",
		"ozaukeeWetlands",
		"racineWetlands",
		"sheboyganWetlands",
		"county-fills"
	];
	
	var wetlandsLegendHolder;
	var wetlandsLegend = [
		"A4",
		"A3",
		"B4",
		"C4",
		"C4b",
		"F4",
		"MF",
		"ER"
	]
	
	var tempMouseOverArr = [];
	
	var fullDisplayControl = false;
	var selectByCountyControl = true;
	
	mapboxgl.accessToken = 'pk.eyJ1IjoiYm9yZG5lcndsZWkiLCJhIjoiY2lyZjd1a2tyMDA3dmc2bmtkcjUzaG5meCJ9.eswxCZSAnob59HR0wEaTpA';
	
	var map = new mapboxgl.Map({
		container: 'map',
		style: 'mapbox://styles/bordnerwlei/cirf7wsrr0003g8nlogxrqxyr',
		center: [-89.5, 44.5],
		zoom: 6
	});
	
	map.addControl(new mapboxgl.Navigation());
	
	var geocoder = new mapboxgl.Geocoder({
		container: 'geocoder-container'
	});
	
	map.addControl(geocoder);
	
	map.on('load', function () {
		map.addSource('ashlandWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/ashland_wetlands.geojson'
		});
		
		map.addSource('bayfieldWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/bayfield_wetlands.geojson'
		});
		
		map.addSource('brownWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/brown_wetlands.geojson'
		});
		
		map.addSource('doorWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/door_wetlands.geojson'
		});
		
		map.addSource('douglasWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/douglas_wetlands.geojson'
		});
		
		map.addSource('ironWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/iron_wetlands.geojson'
		});
		
		map.addSource('kenoshaWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/kenosha_wetlands.geojson'
		});
		
		map.addSource('kewauneeWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/kewaunee_wetlands.geojson'
		});
		
		map.addSource('marinetteWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/marinette_wetlands.geojson'
		});
		
		map.addSource('ozaukeeWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/ozaukee_wetlands.geojson'
		});
		
		map.addSource('racineWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/racine_wetlands.geojson'
		});
		
		map.addSource('sheboyganWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/sheboygan_wetlands.geojson'
		});
		
		map.addSource('coastalCounties', {
			'type': 'geojson',
			'data': 'data/counties.geojson'
		});
		
		map.addSource('single-point', {
			'type': 'geojson',
			'data': {
				'type': 'FeatureCollection',
				'features': []
			}
		});
		
		map.addLayer({
			'id': 'county-fills',
			'type': 'fill',
			'source': 'coastalCounties',
			'layout': {
				'visibility': 'visible'
			},
			'paint': {
				'fill-color': '#f08',
				'fill-opacity': 0
			}
		});
		
		map.addLayer({
			'id': 'county-borders',
			'type': 'line',
			'source': 'coastalCounties',
			'layout': {
				'visibility': 'visible'
			},
			'paint': {
				'line-color': 'black',
				'line-width': 1
			}
		});
		
		map.addLayer({
			'id': 'county-hover',
			'type': 'fill',
			'source': 'coastalCounties',
			'layout': {
				'visibility': 'visible'
			},
			'paint': {
				'fill-color': '#f08',
				'fill-opacity': 1
			}
		});
		
		map.addLayer({
			'id': 'point',
			'source': 'single-point',
			'type': 'circle',
			'paint': {
				'circle-radius': 10,
				'circle-color': '#007cbf'
			}
		});
		

		
		
		var popup = new mapboxgl.Popup({
			closeButton: false,
			closeOnClick: false
		});
	
		map.on('mousemove', function(e) {
			var features = map.queryRenderedFeatures(e.point, { layers: hoverLayers });
			
			if (features.length && features[0].layer.id == "county-fills") {
				map.setFilter("county-hover", ["==", "COUNTY_NAM", features[0].properties.COUNTY_NAM]);
			} else if (features.length && features[0].layer.id != "county-fills") {
				var holdID = features[0].layer.id;
				/* OBJECTID */
			} else {
				map.setFilter("county-hover", ["==", "COUNTY_NAM", ""]);
			}
			
			map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';
			
			if (!features.length) {
				popup.remove();
				return;
			}
		
			var feature = features[0];
			
			if (feature.layer.id == "county-fills") {
				popup.setLngLat(e.lngLat)
					.setHTML(feature.properties.COUNTY_NAM)
					.addTo(map);
			} else {
				popup.setLngLat(e.lngLat)
					.setHTML(feature.properties.Cov1)
					.addTo(map);
			}
		});
		
		map.on ('mouseout', function() {
				map.setFilter("county-hover", ["==", "COUNTY_NAM", ""]);
		});
		
		map.on ('click', function(e) {
			var features = map.queryRenderedFeatures(e.point, { layers: hoverLayers });
		
			var feature = features[0];
		
			if (features.length && feature.layer.id == "county-fills") {
				map.flyTo({
					center: e.lngLat,
					zoom: 8
				});
				
				map.setFilter("county-fills", ["!=", "COUNTY_NAM", feature.properties.COUNTY_NAM]);
					
				determineClick(feature);
			} else if (features.length && feature.layer.id != "county-fills") {
				map.flyTo({
					center: e.lngLat,
					zoom: 13,
					pitch: 35,
					around: e.lngLat,
					animate: true
				});
				document.getElementById("pitch").value = 35;
			} else {
			
			}
					
		});
	});
	
	geocoder.on('result', function(ev) {
		map.getSource('single-point').setData(ev.result.geometry);
	});
	
	
		
	
	function determineClick(feature) {
		var t;
		try {
			for (t=0; t < tempLayers.length; t++) {
				try {
					map.removeLayer(tempLayers[t]);
				} catch (err) {
					return;
				}
			}
		} catch (err) {
			return;
		}
		tempLayers.length = 0;
		currentLayers.length = 0;
		
		var clickedCountyName = feature.properties.COUNTY_NAM;
		var i;
		for (i = 0; i < countyNames.length; i++) {
			if (clickedCountyName == countyNames[i]) {
				displayWetlands(countyIDArr[i], feature);
			} else {
	
			}
		}
	};
	
	
	function displayWetlands(source, feature) {
		var hold = currentLayers.indexOf(source);
		var a4cover = source + "A4";
		var a3cover = source + "A3";
		var b4cover = source + "B4";
		var c4cover = source + "C4";
		var c4bcover = source + "C4b";
		var f4cover = source + "F4";
		var mfcover = source + "MF";
		var ercover = source + "ER";
		
		if (hold == -1) {
			map.addLayer({
				'id': a4cover,
				'type': 'fill',
				'source': source,
				'layout': {
					'visibility': 'visible'
				},
				'filter': ['==', 'Cov1', 'A4'],
				'paint': {
					'fill-color': '#EE7600',
					'fill-opacity': 0.5
				}
			}, 'water');
			hoverLayers.push(a4cover);
			tempLayers.push(a4cover);
			
			map.addLayer({
				'id': a3cover,
				'type': 'fill',
				'source': source,
				'layout': {
					'visibility': 'visible'
				},
				'filter': ['==', 'Cov1', 'A3'],
				'paint': {
					'fill-color': '#FB9B9C',
					'fill-opacity': 0.5
				}
			}, 'water');
			hoverLayers.push(a3cover);
			tempLayers.push(a3cover);
			
			map.addLayer({
				'id': b4cover,
				'type': 'fill',
				'source': source,
				'layout': {
					'visibility': 'visible'
				},
				'filter': ['==', 'Cov1', 'B4'],
				'paint': {
					'fill-color': '#9B9CFB',
					'fill-opacity': 0.5
				}
			}, 'water');
			hoverLayers.push(b4cover);
			tempLayers.push(b4cover);
			
			map.addLayer({
				'id': c4cover,
				'type': 'fill',
				'source': source,
				'layout': {
					'visibility': 'visible'
				},
				'filter': ['==', 'Cov1', 'C4'],
				'paint': {
					'fill-color': '#CD69C9',
					'fill-opacity': 0.5
				}
			}, 'water');
			hoverLayers.push(c4cover);
			tempLayers.push(c4cover);
			
			map.addLayer({
				'id': c4bcover,
				'type': 'fill',
				'source': source,
				'layout': {
					'visibility': 'visible'
				},
				'filter': ['==', 'Cov1', 'C4b'],
				'paint': {
					'fill-color': '#99004D',
					'fill-opacity': 0.5
				}
			}, 'water');
			hoverLayers.push(c4bcover);
			tempLayers.push(c4bcover);
			
			map.addLayer({
				'id': f4cover,
				'type': 'fill',
				'source': source,
				'layout': {
					'visibility': 'visible'
				},
				'filter': ['==', 'Cov1', 'F4'],
				'paint': {
					'fill-color': '#2DA0BA',
					'fill-opacity': 0.5
				}
			}, 'water');
			hoverLayers.push(f4cover);
			tempLayers.push(f4cover);
			
			map.addLayer({
				'id': mfcover,
				'type': 'fill',
				'source': source,
				'layout': {
					'visibility': 'visible'
				},
				'filter': ['==', 'Cov1', 'MF'],
				'paint': {
					'fill-color': '#435645',
					'fill-opacity': 0.5
				}
			}, 'water');
			hoverLayers.push(mfcover);
			tempLayers.push(mfcover);
			
			map.addLayer({
				'id': ercover,
				'type': 'fill',
				'source': source,
				'layout': {
					'visibility': 'visible'
				},
				'filter': ['==', 'Cov1', 'ER'],
				'paint': {
					'fill-color': '#9B9CFB',
					'fill-opacity': 0.5
				}
			}, 'water');
			hoverLayers.push(ercover);
			tempLayers.push(ercover);
			
			currentLayers.push(source);
		} else if (hold >= 0) {
			alert('Wetlands layer is already added');
		}
	};
	
	function updateSlider(x) {
		var valueHold = document.getElementById(x).value;
		map.setPitch(valueHold);
	};
	
	var toolbarControl = 0;
	function toggleToolbar() {
		if (toolbarControl == 0) {
			document.getElementById("toolbar").style.transform = "translate(100%)";
			toolbarControl = 1;
			return toolbarControl;
		} else if (toolbarControl > 0) {
			document.getElementById("toolbar").style.transform = "";
			toolbarControl = 0;
			return toolbarControl;
		}
	};
	
	
	function fullDisplay() {
		fullDisplayControl = true;
		alert('full map display enabled');
		
		map.setLayoutProperty("county-fills", "visibility", "none");
		/*map.setLayoutProperty("county-borders", "visibility", "none");*/
		map.setLayoutProperty("county-hover", "visibility", "none");
		
		
		var z;
		for (z=0; z < countyIDArr.length; z++) {
			displayWetlands(countyIDArr[z]);
		}
		return fullDisplayControl;
	};
	
	function selectByCounty() {
		selectByCountyControl = true;
		alert('select by county display enabled');
		
		var x;
		try {
			for (x=0; x < tempLayers.length; x++) {
				try {
					map.removeLayer(tempLayers[x]);
				} catch (err) {
					return;
				}
			}
		} catch (err) {
			return;
		}
		
		map.setLayoutProperty("county-fills", "visibility", "visible");
		map.setLayoutProperty("county-hover", "visibility", "visible");
		
		currentLayers.length = 0;
		tempLayers.length = 0;
	};
	
	
	function displaySettingsMenu() {
		alert('display settings menu enabled');
	};
	
	
	function displayLikeLegend(id) {
		var spaceHolder = wetlandsLegend.indexOf(id);
		wetlandsLegendHolder = wetlandsLegend[spaceHolder];
		var b;
		try {
			for (b=0; b < tempLayers.length; b++) {
				var c;
				for (c=0; c < countyIDArr.length; c++) {
					var nameHolder = countyIDArr[c] + wetlandsLegendHolder;
					if (tempLayers[b] == nameHolder) {
						/*map.setLayoutProperty(nameHolder, "visibility", "none");*/
						/*tempMouseOverArr.push(nameHolder);*/
						return;
					} else if (tempLayers[b] != nameHolder) {
						console.log(nameHolder);
						map.setLayoutProperty(tempLayers[b], "visibility", "none");
						map.setLayoutProperty(nameHolder, "visibility", "visible");
						tempMouseOverArr.push(tempLayers[b]);
					}
				}
			}
		} catch (err) {
			console.log("not so fast");
		}
	};
	
	function resetLikeLegend() {
		var b;
		try {
			for (b=0; b < tempMouseOverArr.length; b++) {
				map.setLayoutProperty(tempMouseOverArr[b], "visibility", "visible");
			}
			tempMouseOverArr.length = 0;
		} catch (err) {
		
		}
	};
	
	
	</script>
		
</body>
</html>
