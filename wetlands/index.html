<!DOCTYPE html>
<html>

<head>
	<!-- link mapbox library -->
	<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.21.0/mapbox-gl.js'></script>
	
	<!-- link mapbox styling -->
	<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.21.0/mapbox-gl.css' rel='stylesheet' />
	
	<style>
		body {
			margin:0;
			padding:0;
		}
		
		#map {
			position: absolute;
			top:0;
			bottom: 0;
			width:100%;
			height:100%;
		}
		
		.mapboxgl-popup {
		
		}
		
		#geocoder-container {
			position: absolute;
			top: 0;
			width: 100%;
			margin-top: 10px;
		}

		#geocoder-container > div {
			min-width:50%;
			margin-left:25%;
		}
	</style>
</head>
<body>
	<div id='map'></div>
	<div id='geocoder-container'></div>
	
	<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v1.3.0/mapbox-gl-geocoder.js'></script>
	<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v1.3.0/mapbox-gl-geocoder.css' type='text/css' />
	<script src="https://bordnerlab.github.io/wetlands/handleClick.js"></script>
	<script>
	
	var countyIDArr = [
		"ashlandWetlands",
		"bayfieldWetlands",
		"brownWetlands",
		"doorWetlands",
		"douglasWetlands",
		"ironWetlands",
		"kenoshaWetlands",
		"kewauneeWetlands",
		"marinetteWetlands",
		"ozaukeeWetlands",
		"racineWetlands",
		"sheboyganWetlands"
	];
	
	var countyNames = [
		"Ashland",
		"Bayfield",
		"Brown",
		"Door",
		"Douglas",
		"Iron",
		"Kenosha",
		"Kewaunee",
		"Marinette",
		"Ozaukee",
		"Racine",
		"Sheboygan"
	];
	
	var currentLayers = [];
	var countyFillArr = [];
	
	mapboxgl.accessToken = 'pk.eyJ1IjoiYm9yZG5lcndsZWkiLCJhIjoiY2lyZjd1a2tyMDA3dmc2bmtkcjUzaG5meCJ9.eswxCZSAnob59HR0wEaTpA';
	
	var map = new mapboxgl.Map({
		container: 'map',
		style: 'mapbox://styles/bordnerwlei/cirf7wsrr0003g8nlogxrqxyr',
		center: [-89.5, 44.5],
		zoom: 6
	});
	
	map.addControl(new mapboxgl.Navigation());
	
	var geocoder = new mapboxgl.Geocoder({
		container: 'geocoder-container'
	});
	
	map.addControl(geocoder);
	
	map.on('load', function () {
		map.addSource('ashlandWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/ashland_wetlands.geojson'
		});
		
		map.addSource('bayfieldWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/bayfield_wetlands.geojson'
		});
		
		map.addSource('brownWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/brown_wetlands.geojson'
		});
		
		map.addSource('doorWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/door_wetlands.geojson'
		});
		
		map.addSource('douglasWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/douglas_wetlands.geojson'
		});
		
		map.addSource('ironWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/iron_wetlands.geojson'
		});
		
		map.addSource('kenoshaWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/kenosha_wetlands.geojson'
		});
		
		map.addSource('kewauneeWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/kewaunee_wetlands.geojson'
		});
		
		map.addSource('marinetteWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/marinette_wetlands.geojson'
		});
		
		map.addSource('ozaukeeWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/ozaukee_wetlands.geojson'
		});
		
		map.addSource('racineWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/racine_wetlands.geojson'
		});
		
		map.addSource('sheboyganWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/sheboygan_wetlands.geojson'
		});
		
		map.addSource('coastalCounties', {
			'type': 'geojson',
			'data': 'data/counties.geojson'
		});
		
		map.addSource('single-point', {
			'type': 'geojson',
			'data': {
				'type': 'FeatureCollection',
				'features': []
			}
		});
		
		map.addLayer({
			'id': 'county-fills',
			'type': 'fill',
			'source': 'coastalCounties',
			'layout': {},
			'paint': {
				'fill-color': '#f08',
				'fill-opacity': 0
			}
		});
		
		map.addLayer({
			'id': 'county-borders',
			'type': 'line',
			'source': 'coastalCounties',
			'layout': {},
			'paint': {
				'line-color': 'black',
				'line-width': 1
			}
		});
		
		map.addLayer({
			'id': 'county-hover',
			'type': 'fill',
			'source': 'coastalCounties',
			'layout': {},
			'paint': {
				'fill-color': '#f08',
				'fill-opacity': 1
			}
		});
		
		map.addLayer({
			'id': 'point',
			'source': 'single-point',
			'type': 'circle',
			'paint': {
				'circle-radius': 10,
				'circle-color': '#007cbf'
			}
		});
		

		
		
		var popup = new mapboxgl.Popup({
			closeButton: false,
			closeOnClick: false
		});
	
		map.on('mousemove', function(e) {
			var features = map.queryRenderedFeatures(e.point, { layers: ["county-fills"] });
			if (features.length) {
				map.setFilter("county-hover", ["==", "COUNTY_NAM", features[0].properties.COUNTY_NAM]);
			} else {
				map.setFilter("county-hover", ["==", "COUNTY_NAM", ""]);
			}
			
			map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';
			
			if (!features.length) {
				popup.remove();
				return;
			}
		
			var feature = features[0];
		
			popup.setLngLat(e.lngLat)
				.setHTML(feature.properties.COUNTY_NAM)
				.addTo(map);
		});
		
		map.on ('mouseout', function() {
			map.setFilter("county-hover", ["==", "COUNTY_NAM", ""]);
		});
		
		map.on ('click', function(e) {
			var features = map.queryRenderedFeatures(e.point, { layers: ['county-fills'] });
		
			var feature = features[0];
		
			if (features.length) {
				map.flyTo({
					center: e.lngLat,
					zoom: 8
				});
				countyFillArr.push(feature.properties.COUNTY_NAM);
				map.setFilter("county-fills", ['all', 
					["!=", "COUNTY_NAM", countyFillArr[0],
					["!=", "COUNTY_NAM", countyFillArr[1],
					["!=", "COUNTY_NAM", countyFillArr[2],
					["!=", "COUNTY_NAM", countyFillArr[3],
					["!=", "COUNTY_NAM", countyFillArr[4]]);
					
				determineClick(feature);
			}
		});
	});
	
	geocoder.on('result', function(ev) {
		map.getSource('single-point').setData(ev.result.geometry);
	});
	
	
		
	
	function determineClick(feature) {
		var clickedCountyName = feature.properties.COUNTY_NAM;
		var i;
		for (i = 0; i < countyNames.length; i++) {
			if (clickedCountyName == countyNames[i]) {
				displayWetlands(countyIDArr[i], feature);
			} else {
	
			}
		}
	};
	
	
	function displayWetlands(source, feature) {
		var hold = currentLayers.indexOf(source);
		if (hold == -1) {
			map.addLayer({
				'id': source,
				'type': 'fill',
				'source': source,
				'layout': {},
				'paint': {
					'fill-color': '#f08',
					'fill-opacity': 1
				}
			}, 'water');
			
			currentLayers.push(source);
		} else if (hold >= 0) {
			alert('Wetlands layer is already added');
		}
	};
	
	</script>
		
</body>
</html>
