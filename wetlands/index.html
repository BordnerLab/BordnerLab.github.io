<!DOCTYPE html>
<html>

<head>
	<!-- link mapbox library -->
	<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.21.0/mapbox-gl.js'></script>
	
	<!-- link mapbox styling -->
	<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.21.0/mapbox-gl.css' rel='stylesheet' />
	
	<style>
		body {
			margin:0;
			padding:0;
		}
		
		#map {
			position: absolute;
			top:0;
			bottom: 0;
			width:100%;
			height:100%;
		}
		
		.mapboxgl-popup {
		
		}
		
		#geocoder-container {
			position: absolute;
			top: 0;
			width: 100%;
			margin-top: 10px;
		}

		#geocoder-container > div {
			min-width:50%;
			margin-left:25%;
		}
		
		
		#pitch {
			writing-mode: bt-lr;
			-webkit-appearance: slider-vertical;
			position: absolute;
			height: 125px;
			width: auto;
			top:100px;
			right:16px;
			background: transparent;
		}
		
		#toolbar {
			position: absolute;
			width: 50px;
			height: 200px;
			background: black;
			bottom: 0;
			right: 0;
		}
		
		#toolbar #grabHandle {
			width: 20px;
			height: 50px;
			background:red;
			margin-top: 100%;
		}
	</style>
</head>
<body>
	<div id='map'></div>
	<div id='geocoder-container'></div>
	
	
	<input type="range" name="pitch" id="pitch" value="0" min="0" max="60" defaultValue="0" onchange="updateSlider(this.id)" orient="vertical">
	
	<div id='toolbar'>
		<div id='grabHandle'></div>
	</div>
	
	
	
	<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v1.3.0/mapbox-gl-geocoder.js'></script>
	<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v1.3.0/mapbox-gl-geocoder.css' type='text/css' />
	<script>
	
	var countyIDArr = [
		"ashlandWetlands",
		"bayfieldWetlands",
		"brownWetlands",
		"doorWetlands",
		"douglasWetlands",
		"ironWetlands",
		"kenoshaWetlands",
		"kewauneeWetlands",
		"marinetteWetlands",
		"ozaukeeWetlands",
		"racineWetlands",
		"sheboyganWetlands"
	];
	
	var countyNames = [
		"Ashland",
		"Bayfield",
		"Brown",
		"Door",
		"Douglas",
		"Iron",
		"Kenosha",
		"Kewaunee",
		"Marinette",
		"Ozaukee",
		"Racine",
		"Sheboygan"
	];
	
	var currentLayers = [];
	
	var hoverLayers = [
		"ashlandWetlands",
		"bayfieldWetlands",
		"brownWetlands",
		"doorWetlands",
		"douglasWetlands",
		"ironWetlands",
		"kenoshaWetlands",
		"kewauneeWetlands",
		"marinetteWetlands",
		"ozaukeeWetlands",
		"racineWetlands",
		"sheboyganWetlands",
		"county-fills"
	];
		
	
	mapboxgl.accessToken = 'pk.eyJ1IjoiYm9yZG5lcndsZWkiLCJhIjoiY2lyZjd1a2tyMDA3dmc2bmtkcjUzaG5meCJ9.eswxCZSAnob59HR0wEaTpA';
	
	var map = new mapboxgl.Map({
		container: 'map',
		style: 'mapbox://styles/bordnerwlei/cirf7wsrr0003g8nlogxrqxyr',
		center: [-89.5, 44.5],
		zoom: 6
	});
	
	map.addControl(new mapboxgl.Navigation());
	
	var geocoder = new mapboxgl.Geocoder({
		container: 'geocoder-container'
	});
	
	map.addControl(geocoder);
	
	map.on('load', function () {
		map.addSource('ashlandWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/ashland_wetlands.geojson'
		});
		
		map.addSource('bayfieldWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/bayfield_wetlands.geojson'
		});
		
		map.addSource('brownWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/brown_wetlands.geojson'
		});
		
		map.addSource('doorWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/door_wetlands.geojson'
		});
		
		map.addSource('douglasWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/douglas_wetlands.geojson'
		});
		
		map.addSource('ironWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/iron_wetlands.geojson'
		});
		
		map.addSource('kenoshaWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/kenosha_wetlands.geojson'
		});
		
		map.addSource('kewauneeWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/kewaunee_wetlands.geojson'
		});
		
		map.addSource('marinetteWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/marinette_wetlands.geojson'
		});
		
		map.addSource('ozaukeeWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/ozaukee_wetlands.geojson'
		});
		
		map.addSource('racineWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/racine_wetlands.geojson'
		});
		
		map.addSource('sheboyganWetlands', {
			'type': 'geojson',
			'data': 'data/wetlands/sheboygan_wetlands.geojson'
		});
		
		map.addSource('coastalCounties', {
			'type': 'geojson',
			'data': 'data/counties.geojson'
		});
		
		map.addSource('single-point', {
			'type': 'geojson',
			'data': {
				'type': 'FeatureCollection',
				'features': []
			}
		});
		
		map.addLayer({
			'id': 'county-fills',
			'type': 'fill',
			'source': 'coastalCounties',
			'layout': {},
			'paint': {
				'fill-color': '#f08',
				'fill-opacity': 0
			}
		});
		
		map.addLayer({
			'id': 'county-borders',
			'type': 'line',
			'source': 'coastalCounties',
			'layout': {},
			'paint': {
				'line-color': 'black',
				'line-width': 1
			}
		});
		
		map.addLayer({
			'id': 'county-hover',
			'type': 'fill',
			'source': 'coastalCounties',
			'layout': {},
			'paint': {
				'fill-color': '#f08',
				'fill-opacity': 1
			}
		});
		
		map.addLayer({
			'id': 'point',
			'source': 'single-point',
			'type': 'circle',
			'paint': {
				'circle-radius': 10,
				'circle-color': '#007cbf'
			}
		});
		

		
		
		var popup = new mapboxgl.Popup({
			closeButton: false,
			closeOnClick: false
		});
	
		map.on('mousemove', function(e) {
			var features = map.queryRenderedFeatures(e.point, { layers: hoverLayers });
			
			if (features.length && features[0].layer.id == "county-fills") {
				map.setFilter("county-hover", ["==", "COUNTY_NAM", features[0].properties.COUNTY_NAM]);
			} else if (features.length && features[0].layer.id != "county-fills") {
				var holdID = features[0].layer.id;
				/* OBJECTID */
			} else {
				map.setFilter("county-hover", ["==", "COUNTY_NAM", ""]);
			}
			
			map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';
			
			if (!features.length) {
				popup.remove();
				return;
			}
		
			var feature = features[0];
			
			if (feature.layer.id == "county-fills") {
				popup.setLngLat(e.lngLat)
					.setHTML(feature.properties.COUNTY_NAM)
					.addTo(map);
			} else {
				popup.setLngLat(e.lngLat)
					.setHTML(feature.properties.Cov1)
					.addTo(map);
			}
		});
		
		map.on ('mouseout', function() {
			map.setFilter("county-hover", ["==", "COUNTY_NAM", ""]);
		});
		
		map.on ('click', function(e) {
			var features = map.queryRenderedFeatures(e.point, { layers: hoverLayers });
		
			var feature = features[0];
		
			if (features.length && feature.layer.id == "county-fills") {
				map.flyTo({
					center: e.lngLat,
					zoom: 8
				});
				
				map.setFilter("county-fills", ["!=", "COUNTY_NAM", feature.properties.COUNTY_NAM]);
					
				determineClick(feature);
			} else if (features.length && feature.layer.id != "county-fills") {
				map.flyTo({
					center: e.lngLat,
					zoom: 13,
					pitch: 35,
					around: e.lngLat,
					animate: true
				});
				document.getElementById("pitch").value = 35;
			} else {
			
			}
					
		});
	});
	
	geocoder.on('result', function(ev) {
		map.getSource('single-point').setData(ev.result.geometry);
	});
	
	
		
	
	function determineClick(feature) {
		var clickedCountyName = feature.properties.COUNTY_NAM;
		var i;
		for (i = 0; i < countyNames.length; i++) {
			if (clickedCountyName == countyNames[i]) {
				displayWetlands(countyIDArr[i], feature);
			} else {
	
			}
		}
	};
	
	
	function displayWetlands(source, feature) {
		var hold = currentLayers.indexOf(source);
		var a4cover = source + "A4";
		var a3cover = source + "A3";
		var b4cover = source + "B4";
		var c4cover = source + "C4";
		var c4bcover = source + "C4b";
		var f4cover = source + "F4";
		var mfcover = source + "MF";
		var ercover = source + "ER";
		if (hold == -1) {
			map.addLayer({
				'id': a4cover,
				'type': 'fill',
				'source': source,
				'layout': {},
				'filter': ['==', 'Cov1', 'A4'],
				'paint': {
					'fill-color': '#EE7600',
					'fill-opacity': 0.5
				}
			}, 'water');
			hoverLayers.push(a4cover);
			
			map.addLayer({
				'id': a3cover,
				'type': 'fill',
				'source': source,
				'layout': {},
				'filter': ['==', 'Cov1', 'A3'],
				'paint': {
					'fill-color': '#FB9B9C',
					'fill-opacity': 0.5
				}
			}, 'water');
			hoverLayers.push(a3cover);
			
			map.addLayer({
				'id': b4cover,
				'type': 'fill',
				'source': source,
				'layout': {},
				'filter': ['==', 'Cov1', 'B4'],
				'paint': {
					'fill-color': '#9B9CFB',
					'fill-opacity': 0.5
				}
			}, 'water');
			hoverLayers.push(b4cover);
			
			map.addLayer({
				'id': c4cover,
				'type': 'fill',
				'source': source,
				'layout': {},
				'filter': ['==', 'Cov1', 'C4'],
				'paint': {
					'fill-color': '#CD69C9',
					'fill-opacity': 0.5
				}
			}, 'water');
			hoverLayers.push(c4cover);
			
			map.addLayer({
				'id': c4bcover,
				'type': 'fill',
				'source': source,
				'layout': {},
				'filter': ['==', 'Cov1', 'C4b'],
				'paint': {
					'fill-color': '#99004D',
					'fill-opacity': 0.5
				}
			}, 'water');
			hoverLayers.push(c4bcover);
			
			map.addLayer({
				'id': f4cover,
				'type': 'fill',
				'source': source,
				'layout': {},
				'filter': ['==', 'Cov1', 'F4'],
				'paint': {
					'fill-color': '#2DA0BA',
					'fill-opacity': 0.5
				}
			}, 'water');
			hoverLayers.push(f4cover);
			
			map.addLayer({
				'id': mfcover,
				'type': 'fill',
				'source': source,
				'layout': {},
				'filter': ['==', 'Cov1', 'MF'],
				'paint': {
					'fill-color': '#435645',
					'fill-opacity': 0.5
				}
			}, 'water');
			hoverLayers.push(mfcover);
			
			map.addLayer({
				'id': ercover,
				'type': 'fill',
				'source': source,
				'layout': {},
				'filter': ['==', 'Cov1', 'ER'],
				'paint': {
					'fill-color': '#9B9CFB',
					'fill-opacity': 0.5
				}
			}, 'water');
			hoverLayers.push(ercover);
			
			currentLayers.push(source);
		} else if (hold >= 0) {
			alert('Wetlands layer is already added');
		}
	};
	
	function updateSlider(x) {
		var valueHold = document.getElementById(x).value;
		map.setPitch(valueHold);
	};
	
	
	
	
	</script>
		
</body>
</html>
