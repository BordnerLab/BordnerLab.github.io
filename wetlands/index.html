<!DOCTYPE html>
<html>

<head>
	<!-- link mapbox library -->
	<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.21.0/mapbox-gl.js'></script>
	
	<!-- link mapbox styling -->
	<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.21.0/mapbox-gl.css' rel='stylesheet' />
	
	<style>
		body {
			margin:0;
			padding:0;
		}
		
		#map {
			position: absolute;
			top:0;
			bottom: 0;
			width:100%;
			height:100%;
		}
		
		.mapboxgl-popup {
		
		}
	</style>
</head>
<body>
	<div id='map'></div>
	
	<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v1.3.0/mapbox-gl-geocoder.js'></script>
	<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v1.3.0/mapbox-gl-geocoder.css' type='text/css' />
	<script>
	mapboxgl.accessToken = 'pk.eyJ1IjoiYm9yZG5lcndsZWkiLCJhIjoiY2lyZjd1a2tyMDA3dmc2bmtkcjUzaG5meCJ9.eswxCZSAnob59HR0wEaTpA';
	
	var map = new mapboxgl.Map({
		container: 'map',
		style: 'mapbox://styles/bordnerwlei/cirf7wsrr0003g8nlogxrqxyr',
		center: [-89.5, 44.5],
		zoom: 6
	});
	
	map.addControl(new mapboxgl.Navigation());
	
	map.addControl(new mapboxgl.Geocoder());
	
	map.on('load', function () {
		map.addSource('ashlandWetlands', {
			'type': 'geojson',
			'data': 'https://bordnerlab.github.io/wetlands/data/wetlands/ashland_wetlands.geojson'
		});
		
		map.addSource('coastalCounties', {
			'type': 'geojson',
			'data': 'https://bordnerlab.github.io/wetlands/data/counties.geojson'
		});
		/*
		map.addLayer({
			'id': 'ashlandWetlands',
			'type': 'fill',
			'source': 'ashlandWetlands',
			'layout': {},
			'paint': {
				'fill-color': '#f08',
				'fill-opacity': 0.4
			}
		}, 'water');
		*/
		map.addLayer({
			'id': 'county-fills',
			'type': 'fill',
			'source': 'coastalCounties',
			'layout': {},
			'paint': {
				'fill-color': '#f08',
				'fill-opacity': 0.2,
			}
		});
		
		map.addLayer({
			'id': 'county-borders',
			'type': 'line',
			'source': 'coastalCounties',
			'layout': {},
			'paint': {
				'line-color': 'black',
				'line-width': 1
			}
		});
		
		map.addLayer({
			'id': 'county-hover',
			'type': 'fill',
			'source': 'coastalCounties',
			'layout': {},
			'paint': {
				'fill-color': '#f08',
				'fill-opacity': 1
			}
		});
	});
	
	var popup = new mapboxgl.Popup({
		closeButton: false,
		closeOnClick: false
	});
	
	map.on('mousemove', function(e) {
		var features = map.queryRenderedFeatures(e.point, { layers: ["county-fills"] });
		if (features.length) {
			map.setFilter("county-hover", ["==", "COUNTY_NAM", features[0].properties.COUNTY_NAM]);
		} else {
			map.setFilter("county-hover", ["==", "COUNTY_NAM", ""]);
		}
			
		map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';
			
		if (!features.length) {
			popup.remove();
			return;
		}
		
		var feature = features[0];
		
		popup.setLngLat(e.lngLat)
			.setHTML(feature.properties.COUNTY_NAM)
			.addTo(map);
	});
	
	map.on ('mouseout', function() {
		map.setFilter("county-hover", ["==", "COUNTY_NAM", ""]);
	});
	
	
	
	</script>
		
</body>
</html>
